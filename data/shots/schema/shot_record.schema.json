{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Shot Record Schema",
  "type": "object",
  "required": ["shot_id", "refs", "balls", "inputs"],
  "properties": {
    "shot_id": {
      "type": "string"
    },

    "created_at": {
      "type": "string",
      "format": "date-time"
    },

    "updated_at": {
      "type": "string",
      "format": "date-time"
    },

    "refs": {
      "type": "object",
      "required": ["system_id"],
      "properties": {
        "system_id": { "type": "string" },
        "system_version": { "type": "string" },
        "track_base": {
          "type": "string",
          "enum": ["B2T_L", "B2T_R", "T2B_L", "T2B_R"]
        },
        "curve_model": {
          "type": "object",
          "properties": {
            "id": { "type": "string" },
            "enabled": { "type": "boolean" }
          }
        }
      }
    },

    "balls": {
      "type": "object",
      "required": ["cue_ball", "target_ball", "second_ball"],
      "properties": {
        "cue_ball": { "$ref": "#/definitions/ball" },
        "target_ball": { "$ref": "#/definitions/ball" },
        "second_ball": { "$ref": "#/definitions/ball" }
      }
    },

    "inputs": {
      "type": "object",
      "properties": {
        "sys": {
          "type": "object",
          "properties": {
            "co": { "type": "integer", "minimum": 0, "maximum": 99 },
            "c3": { "type": "integer", "minimum": 0, "maximum": 80 },
            "delta": {
              "type": "object",
              "properties": {
                "push": { "type": "integer", "minimum": 0, "maximum": 9 },
                "pull": { "type": "integer", "minimum": -9, "maximum": 0 },
                "start": { "type": "integer", "minimum": -9, "maximum": 9 }
              }
            },
            "target_calc_rule": {
              "type": "string",
              "enum": ["3C_PLUS_CORRECTION", "3C_MINUS_CORRECTION"]
            }
          }
        },

        "hpt": {
          "type": "object",
          "properties": {
            "hit_point": {
              "type": "object",
              "properties": {
                "x": { "type": "number", "minimum": -0.3, "maximum": 0.3 },
                "y": { "type": "number", "minimum": -0.3, "maximum": 0.3 }
              },
              "required": ["x", "y"]
            },
            "thickness": {
              "type": "integer",
              "minimum": 1,
              "maximum": 7
            }
          }
        },

        "str": {
          "type": "object",
          "properties": {
            "speed_style": {
              "type": "string",
              "enum": ["CONST", "ACCEL", "DECEL"]
            },
            "stroke_type": {
              "type": "string",
              "enum": ["SHORT", "STANDARD", "LONG"]
            },
            "rail_speed": {
              "type": "number",
              "minimum": 0
            }
          }
        },

        "ai": {
          "type": "object",
          "properties": {
            "coaching_id": { "type": "string" },
            "coaching_text": { "type": "string" }
          }
        }
      }
    },

    "segments": {
      "type": "object",
      "description": "Derived geometry samples (not SSOT)",
      "properties": {
        "co_to_impact": { "$ref": "#/definitions/segment_range" },
        "cushion_to_target": { "$ref": "#/definitions/segment_const" }
      }
    }
  },

  "definitions": {
    "ball": {
      "type": "object",
      "properties": {
        "x": { "type": "number", "minimum": 0.5, "maximum": 79.5 },
        "y": { "type": "number", "minimum": 0.5, "maximum": 39.5 }
      },
      "required": ["x", "y"]
    },

    "segment_const": {
      "type": "object",
      "properties": {
        "sample_count": { "type": "integer", "minimum": 2, "maximum": 20 },
        "points": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "number" },
            "minItems": 2,
            "maxItems": 2
          }
        }
      }
    },

    "segment_range": {
      "type": "object",
      "properties": {
        "active_range": {
          "type": "object",
          "properties": {
            "from": { "type": "number", "minimum": 0, "maximum": 1 },
            "to": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        },
        "sample_count": { "type": "integer", "minimum": 2, "maximum": 20 },
        "points": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "number" },
            "minItems": 2,
            "maxItems": 2
          }
        }
      }
    }
  }
}
